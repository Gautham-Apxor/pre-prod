!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],t):(e=e||self)["apxor-qe"]=t(e.Apxor)}(this,(function(e){"use strict";function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,f(i.key),i)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=f(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(s.push(i.value),s.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(l)throw r}}return s}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function f(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var h=window.ApxorLogger,_=function(e){return void 0===e},g=function(e){return null===e},m=function(e){return void 0!==e&&!g(e)},p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function y(e,t){return Array.from(t).map((function(t,n){return String.fromCharCode(t^function(e,t){return e.charCodeAt(Math.floor(t%e.length))}(e,n))})).join("")}var w=function(e,t){return y(e,t=function(e){var t,n,i,r,a,o,s=0,u=[];if(!e)return e;e+="";do{t=(o=p.indexOf(e.charAt(s++))<<18|p.indexOf(e.charAt(s++))<<12|(r=p.indexOf(e.charAt(s++)))<<6|(a=p.indexOf(e.charAt(s++))))>>16&255,n=o>>8&255,i=255&o,u.push(t),64!==r&&(u.push(n),64!==a&&u.push(i))}while(s<e.length);return u}(t))},x=function(e){return m(e)&&!g(e)&&!isNaN(e)},I=function(e){switch(e){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE";case"apxor_event":return"AEV";case"customer_event":return"CEV";case"any_event":return"ANV";case"campaign_event":return"CNV";case"survey_event":return"SVE"}return"Unknown"},F=function(e){return e.toUpperCase()},E=function(e,t,n){switch(n){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;case"NEQ":return e!==t;case"R":return V(t).test(e);default:return!1}},V=function(e){var t=e.replace(/.*\/([gimuy]*)$/,"$1");t===e&&(t="");var n=t?e.replace(new RegExp("^/(.*?)/"+t+"$"),"$1"):e;return new RegExp(n,t)},b=function(){var e=new Date;return e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear()},D=function(e,t,n){if("GT"===n){var i=e.split(":"),r=t.split(":");if(!(i[0]>=r[0]))return!1;if(i[0]>r[0])return!0;if(i[0]!=r[0])return!1;if(i[1]>=r[1])return!0}else if("LT"===n){var a=e.split(":"),o=t.split(":");if(!(a[0]<=o[0]))return!1;if(a[0]<o[0])return!0;if(a[0]!=o[0])return!1;if(a[1]<=o[1])return!0}},S=function(e,t){switch(e){case"second":return 1e3*t;case"minute":return 60*t*1e3;case"hour":return 60*t*60*1e3;case"day":return 24*t*60*60*1e3;default:return 1}},C=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e||!t||!n)return!1;var r=n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),a=t.replace(new RegExp(r,"g"),"(.+)"),o=i?"^".concat(a):"".concat(a,"$"),s=new RegExp(o);return s.test(e)};function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=M(e,t);if(a){var o=function(){if(A(a)){return function(e){return G(e)}(a)}return h.info("Invalid target element. Width and height are 0 for element: ".concat(e,". Can't show tooltip")),!1};return o()}return n?(h.info("Not found yet. Rechecking the DOM."),T(r,i,e,t)):(h.info("Element with selector:".concat(e," not found.")),!1)}function T(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=setInterval((function(){var t=M(n,i);if(t){clearInterval(r);!function(){if(A()){G()}else h.info("Invalid target element. Width and height are 0 for element: ".concat(n,". Can't show tooltip"))}()}else(e-=1)<=0&&(clearInterval(r),console.warn("Element with selector:".concat(n," not found.")))}),t)}var M=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=document.getElementById(e);if(!i)try{i=document.querySelector(e)}catch(e){window.ApxorLogger.error("Error finding element in DOM:"+e)}(i||(i=U(e)),!i&&n.length>0)&&(i=null===(t=document.getElementById(n))||void 0===t||null===(t=t.contentWindow)||void 0===t||null===(t=t.document)||void 0===t?void 0:t.querySelector(e));return i},U=function(e){var t=e.indexOf("svg");-1!==t&&(e=e.substring(0,t)+"svg:svg");try{return document.rbXP(e,document,(function(e){return"svg"===e?"http://www.w3.org/2000/svg":null}),XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}catch(e){window.ApxorLogger.error("Error finding element in DOM:"+e)}return null};function A(e){try{var t=e.getBoundingClientRect();if(0===t.width||0===t.height)return!1}catch(e){return!1}return!0}function L(e,t){for(var n=0;n<e.length;n++)if(e[n].hasOwnProperty(t))return e[n];return null}function G(e){var t,n,i,r;return!!(n=(t=e).offsetHeight,i=t.offsetWidth,(r=t.getBoundingClientRect()).left>=-i&&r.top>=-n&&r.right<=(window.innerWidth||document.documentElement.clientWidth)+i&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight)+n)}var k=function(e){!function(e){var t='\n        <style> \n          .apx-container{\n            padding:10px;\n          }\n        </style>\n        <div id="apx-innerElement" class="apx-container">\n              <div id="close-button" style="cursor: pointer;position:absolute;top:9px;right:9px;"><svg width="11" height="11" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path opacity="0.5" d="M11.0962 9.07071L17.8586 15.8331L15.8331 17.8586L9.0707 11.0962L8.99999 11.0255L8.92928 11.0962L2.16693 17.8586L0.141421 15.8331L6.90379 9.07071L6.9745 9L6.90379 8.92929L0.141421 2.16694L2.16693 0.141422L8.92928 6.9038L8.99999 6.97451L9.0707 6.9038L15.8331 0.141422L17.8586 2.16694L11.0962 8.92929L11.0255 9L11.0962 9.07071Z" fill="white" stroke="#002845" stroke-width="0.2"/>\n                </svg>\n              </div>\n              <div style="font-family: inherit;font-style: normal;font-weight: 600;font-size: 16px;line-height: 22px;\n              color: #FFFFFF; display: flex; gap: 12px;"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-circle-check-filled" width="33" height="33" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">\n  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n  <path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.293 5.953a1 1 0 0 0 -1.32 -.083l-.094 .083l-3.293 3.292l-1.293 -1.292l-.094 -.083a1 1 0 0 0 -1.403 1.403l.083 .094l2 2l.094 .083a1 1 0 0 0 1.226 0l.094 -.083l4 -4l.083 -.094a1 1 0 0 0 -.083 -1.32z" stroke-width="0" fill="currentColor" />\n</svg><div style = "align-self: center;padding-right:20px;">'.concat(e,"</div></div>\n        </div>\n      "),n=document.createElement("div");n.style="\n        z-index:99999999;\n        background:#16202f;\n        position:fixed;\n        top:1%;\n        right:1%;\n        border-radius: 12px;\n      ",n.innerHTML=t,n.id="apx-container",document.body.appendChild(n)}(e);var t=document.getElementById("close-button"),n=function(){var e=document.getElementById("apx-container");null==e||e.remove()};null==t||t.addEventListener("click",n),window.setTimeout(n,2e4)},J=window.ApxorLogger,O=o((function t(){var n=this;r(this,t),s(this,"KMXB","ALL"),s(this,"fPyP",[]),s(this,"DixG",[]),s(this,"userAttributesValidated",!0),s(this,"sessionAttributeValidated",!0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.KMXB=e.audience.audience_type,n.fPyP=e.audience.attributes.user,n.DixG=e.audience.attributes.session,!Array.isArray(n.fPyP)||!Array.isArray(n.DixG))return J.error("No attributes"),!1}catch(e){return J.error(e),!1}return!0})),s(this,"validate",(function(t,i){var r=!0;"FTU"===n.KMXB&&(r=e.getController().getSessionInfo().is_first_session);var a=n.rNCO(t,n.fPyP),o=n.rNCO(i,n.DixG);return a||(n.userAttributesValidated=!1),o||(n.sessionAttributeValidated=!1),r&&a&&o})),s(this,"rNCO",(function(e,t){var n=t.length,i=!0;try{for(var r,a=function(){var n=t[o];if(_(e[n.name])||!1===i)return{v:!1};var r=n.operator,a=n.type,s=n.value.map((function(e){if("s"===a)return e;if("l"===a)return parseInt(e);if("f"===a)return parseFloat(e);if("b"===a)switch(e){case"true":return!0;case"false":return!1;default:return e}})),u=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return s.some((function(t){return"s"===a?e="".concat(e):"l"===a?e=parseInt(e):"f"===a?e=parseFloat(e):"b"===a&&(e=!!e),E(e,t,r)}))}));i=i&&u},o=0;o<n;o++)if(r=a())return r.v}catch(e){J.error(e),i=!1}return i}))})),N=o((function e(){var t=this;r(this,e),s(this,"azhd",""),s(this,"Xqan",{}),s(this,"NZVk",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{t.azhd=e.name,t.Xqan=e.additional_info,t.NZVk=null==e?void 0:e.path}catch(e){return!1}return!0}))})),z=o((function e(){var t=this;r(this,e),s(this,"PLhE",0),s(this,"vCcl",0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.PLhE=Number(e.lower),t.vCcl=Number(e.upper),isNaN(t.PLhE)||isNaN(t.vCcl))return!1}catch(e){return!1}return!0}))})),X=o((function e(){var t=this;r(this,e),s(this,"MVWq",0),s(this,"Bydx",""),s(this,"Maht",""),s(this,"FtFx",new N),s(this,"XkIX",new z),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return t.Bydx=e.event_type,t.Maht=e.activity,t.FtFx.parse(e.details)&&t.XkIX.parse(e.time_bounds)}catch(e){return!1}}))})),q=window.ApxorLogger,P=o((function e(){var t=this;r(this,e),s(this,"MVWq",0),s(this,"LXWu",-1),s(this,"nZSV",0),s(this,"nwvy",""),s(this,"Maht",""),s(this,"Bydx",""),s(this,"XkIX",new z),s(this,"FtFx",new N),s(this,"oDLU",new X),s(this,"CMvH","AND"),s(this,"rpwp",!1),s(this,"KMXB",void 0),s(this,"DVfz",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;return t.LXWu=null==e?void 0:e.sequence,t._conditionType=null==e?void 0:e.condition_type,t._id=null==e?void 0:e._id,t._eventCategory=null!=e&&e.event_category?null==e?void 0:e.event_category:"specific_event",t.nZSV=null==e||null===(n=e.count_config)||void 0===n?void 0:n.count,t.nwvy=null==e||null===(i=e.count_config)||void 0===i?void 0:i.operator,t.Maht=null==e?void 0:e.activity,t.Bydx=null==e?void 0:e.event_type,t.CMvH=e.combine_operator,t._timeEnabled=null==e?void 0:e.time_enabled,t._time=null==e?void 0:e.time,t.KMXB=null==e?void 0:e.type,t.DVfz=null==e?void 0:e.route,t.FtFx.parse(null==e?void 0:e.details)&&t.oDLU.parse(e.trigger)&&t.XkIX.parse(e.time_bounds)}catch(e){return q.error(e),!1}}))})),K=window.ApxorLogger,R=o((function e(){var t=this;r(this,e),s(this,"nZSV",0),s(this,"nwvy",""),s(this,"Bydx",""),s(this,"XkIX",new z),s(this,"FtFx",new N),s(this,"CMvH","AND"),s(this,"parse",(function(e){try{return t.nZSV=e.count_config.count,t.nwvy=e.count_config.operator,t.Bydx=e.event_type,t.CMvH=e.combine_operator,t.FtFx.parse(e.details)&&t.XkIX.parse(e.time_bounds)}catch(e){return K.error(e),!1}}))})),Z=window.ApxorLogger,j=function(){function t(){var n=this;r(this,t),s(this,"fJuk",0),s(this,"IBTs",""),s(this,"swaI",new P),s(this,"OzZr",new R),s(this,"uIPR",!1),s(this,"muDf",!1),s(this,"VNPv",0),s(this,"CMvH","AND"),s(this,"KddY","OR"),s(this,"BKLa",-1),s(this,"Vlnz",[]),s(this,"nQEL",{}),s(this,"dvMa",!1),s(this,"syko",void 0),s(this,"HTKA",void 0),s(this,"QUNT",void 0),s(this,"wxBx",void 0),s(this,"no_KPI_TriggerDetails",[]),s(this,"JmZU",!1),s(this,"timerDidnt",void 0),s(this,"timerDid",void 0),s(this,"initialize",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1,d=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if(n.IBTs=i,n.VNPv=r,n.Vlnz=o,n.syko=a,n.childConditionIndex=l,n.across_sessions=s||!1,"termination"===u&&""!==u){n.OzZr.parse(t);return n.KddY=n.OzZr.CMvH,n.ByEr(),!0}var v=n.swaI.parse(t);if(v){if(n.CMvH=n.swaI.CMvH,n.swaI.rpwp){var c=n.swaI.FtFx.azhd;"APX_PAGE_OPENED"===c&&(c=n.swaI.FtFx.Xqan.navigation_id,c=m(c)?c:n.swaI.FtFx.azhd),n.BKLa=e.getController().getEventCount(c);var f=n.swaI.nZSV,h=n.swaI.nwvy;if(n.muDf=n.hzxw(n.BKLa-1,f,h,!1),n.uIPR=n.muDf,n.muDf&&"APX_PAGE_OPENED"===n.swaI.FtFx.azhd)return!0}return!0===d&&(a&&0!==r&&"unordered"!==a||n.egMV()),!0}return!1})),s(this,"egMV",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;-1!=t&&(n.HTKA=t);var i=n.swaI,r=null!=i&&i._eventCategory?null==i?void 0:i._eventCategory:"specific_event",a=i.oDLU,o=_e.getInstance();if("app_start"===a.Bydx)if(n.uIPR=!0,null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var s=S(i._time.unit,i._time.value);if("didn't"==(null==i?void 0:i.KMXB)){if(n.dvMa=!1,n.timerDidnt=setTimeout((function(){n.dvMa||(n.muDf=!0,n.muDf&&(n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.swaI.nZSV,n.swaI.nwvy),n.muDf&&(n.swaI.MVWq=Date.now(),n.dvMa=!1,o.validate(n.IBTs,n.VNPv,n.HTKA))),"specific_event"===r?o.unregisterFromEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.UKCS):n.DxVr(r),n.uIPR=!1)}),s),n.across_sessions){var u=S(i._time.unit,i._time.value),l=i._timeEnabled,d=i._id;n.MicF(i.KMXB,i.FtFx.azhd,Date.now(),i.FtFx.Xqan,u,l,d)}"specific_event"===r?(o.registerForEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.UKCS),n.wxBx=n.swaI):n.aqBD(r)}else if("did"==(null==i?void 0:i.KMXB)){if(n.timerDid=setTimeout((function(){n.JmZU||("specific_event"===r?o.unregisterFromEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.BEBp):n.ZGud(r))}),s),n.across_sessions){var v=S(i._time.unit,i._time.value),c=i._timeEnabled,f=i._id;n.MicF(i.KMXB,i.FtFx.azhd,Date.now(),i.FtFx.Xqan,v,c,f)}"specific_event"===r?(o.registerForEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.BEBp),n.QUNT=n.swaI):n.fOfM(r)}}}else"specific_event"===r?o.registerForEvent(I(i.Bydx)+"___"+i.FtFx.azhd,n.bBdT):n.pZUQ(r);else if(null!=i&&i._timeEnabled){if("session"!=(null==i?void 0:i._time.unit)){var h=S(i._time.unit,i._time.value);"didn't"==(null==i?void 0:i.KMXB)?(n.dvMa=!1,n.timerDidnt=setTimeout((function(){n.dvMa||(n.muDf=!0,n.muDf&&(n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.swaI.nZSV,n.swaI.nwvy),n.muDf&&(n.swaI.MVWq=Date.now(),n.dvMa=!1,o.validate(n.IBTs,n.VNPv)))),"specific_event"===r&&o.unregisterFromEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.UKCS),n.uIPR=!1}),h),"specific_event"===r?(o.registerForEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.UKCS),n.wxBx=n.swaI):n.aqBD()):"did"==(null==i?void 0:i.KMXB)&&(n.timerDid=setTimeout((function(){n.JmZU||"specific_event"===r&&o.unregisterFromEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.BEBp)}),h),"specific_event"===r&&o.registerForEvent(I(n.swaI.Bydx)+"___"+n.swaI.FtFx.azhd,n.BEBp))}}else"specific_event"===r&&o.registerForEvent(I(i.Bydx)+"___"+a.FtFx.azhd,n.bBdT);null!==(e=window.ApxorRTM)&&void 0!==e&&e.badgesLists.includes(n.IBTs)&&o.registerForEvent(I(i.Bydx)+"___"+"apxor-badge-container-".concat("-".concat(n.IBTs).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.bBdT)})),s(this,"pZUQ",(function(e){var t=new _e;"apxor_event"===e?t.registerForEvent("apxor_event",(function(e,t,i,r){n.bBdT(I(n.swaI.Bydx),n.swaI.FtFx.azhd,i,n.swaI.FtFx.Xqan)})):"customer_event"===e?t.registerForEvent("customer_event",(function(e,t,i,r){n.bBdT(I(n.swaI.Bydx),n.swaI.FtFx.azhd,i,n.swaI.FtFx.Xqan)})):"any_event"===e?t.registerForEvent("any_event",(function(e,t,i,r){n.bBdT(I(n.swaI.Bydx),n.swaI.FtFx.azhd,i,n.swaI.FtFx.Xqan)})):"campaign_event"===e?t.registerForEvent("campaign_event",(function(e,t,i,r){n.bBdT(I(n.swaI.Bydx),n.swaI.FtFx.azhd,i,n.swaI.FtFx.Xqan)})):"survey_event"===e&&t.registerForEvent("survey_event",(function(e,t,i,r){n.bBdT(I(n.swaI.Bydx),n.swaI.FtFx.azhd,i,n.swaI.FtFx.Xqan)}))})),s(this,"DxVr",(function(e){var t=new _e,i=n.swaI._eventCategory;"apxor_event"===i?t.unregisterFromEvent("apxor_event",n.UKCS):"customer_event"===i?t.unregisterFromEvent("customer_event",n.UKCS):"any_event"===i?t.unregisterFromEvent("any_event",n.UKCS):"campaign_event"===i?t.unregisterFromEvent("campaign_event",n.UKCS):"survey_event"===i&&t.unregisterFromEvent("survey_event",n.UKCS)})),s(this,"aqBD",(function(){var e=new _e,t=n.swaI._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.UKCS):"customer_event"===t?e.registerForEvent("customer_event",n.UKCS):"any_event"===t?e.registerForEvent("any_event",n.UKCS):"campaign_event"===t?e.registerForEvent("campaign_event",n.UKCS):"survey_event"===t&&e.registerForEvent("survey_event",n.UKCS)})),s(this,"fOfM",(function(){var e=new _e,t=n.swaI._eventCategory;"apxor_event"===t?e.registerForEvent("apxor_event",n.BEBp):"customer_event"===t?e.registerForEvent("customer_event",n.BEBp):"any_event"===t?e.registerForEvent("any_event",n.BEBp):"campaign_event"===t?e.registerForEvent("campaign_event",n.BEBp):"survey_event"===t&&e.registerForEvent("survey_event",n.BEBp)})),s(this,"ZGud",(function(){var e=new _e,t=n.swaI._eventCategory;"apxor_event"===t?e.unregisterFromEvent("apxor_event",n.BEBp):"customer_event"===t?e.unregisterFromEvent("customer_event",n.BEBp):"any_event"===t?e.unregisterFromEvent("any_event",n.BEBp):"campaign_event"===t?e.unregisterFromEvent("campaign_event",n.BEBp):"survey_event"===t&&e.unregisterFromEvent("survey_event",n.BEBp)})),s(this,"ByEr",(function(){var e=n.OzZr,t=_e.getInstance();n.uIPR=!0,t.registerForEvent(I(e.Bydx)+"___"+e.FtFx.azhd,n.daNu)})),s(this,"Jiup",(function(e,t,i,r){var a,o=(Date.now()-n.nQEL[t])/1e3;(null===(a=n.swaI)||void 0===a||null===(a=a.FtFx)||void 0===a||null===(a=a.Xqan)||void 0===a?void 0:a.time)/1e3>o&&n._displayCampaign(i)})),s(this,"tNCx",(function(e,t,i,r){var a,o;n.dvMa=!0;var s=Date.now(),u=null===(a=n.swaI)||void 0===a||null===(a=a.oDLU)||void 0===a?void 0:a.FtFx.azhd,l=(s-n.nQEL[u])/1e3,d=null===(o=n.swaI)||void 0===o||null===(o=o.FtFx)||void 0===o||null===(o=o.Xqan)||void 0===o?void 0:o.time;(d/=1e3)>l&&n._displayCampaign(i)})),s(this,"BEBp",(function(){n.JmZU=!0;var e=new _e;clearTimeout(n.timerDid),n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.swaI.nZSV,n.swaI.nwvy),n.muDf&&(e.unregisterFromEvent(I(n.QUNT.Bydx)+"___"+n.QUNT.FtFx.azhd,n.BEBp),n.JmZU=!1,e.validate(n.IBTs,n.VNPv,n.HTKA))})),s(this,"UKCS",(function(e,t,i,r){n.dvMa=!0,clearTimeout(n.timerDidnt),(new _e).unregisterFromEvent(I(n.wxBx.Bydx)+"___"+n.wxBx.FtFx.azhd,n.UKCS)})),s(this,"bBdT",(function(t,i,r,a){var o,s,u=_e.getInstance();if(n.uIPR){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.IBTs)&&e.getController().isBadgeTriggerSatisfied(n.IBTs))return n.muDf=!0,n.swaI.MVWq=r,void u.validate(n.IBTs,n.VNPv);if(I(n.swaI.Bydx)===t&&n.wxOD(r-n.swaI.oDLU.MVWq,n.swaI.XkIX)&&n.swaI.FtFx.azhd===i&&n.Fciv(n.swaI.FtFx.Xqan,a)&&(n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.swaI.nZSV,n.swaI.nwvy),n.muDf)){if(n.swaI.MVWq=r,n.across_sessions){var l=S(n.swaI._time.unit,n.swaI._time.value),d=n.swaI._timeEnabled,v=n.swaI._id,c=n.fJuk;n.MicF(n.swaI.KMXB,i,r,a,l,d,v,c)}u.validate(n.IBTs,n.VNPv,n.HTKA)}}else if(n.uIPR=n.QLKW(t,i,r,a),n.uIPR){var f=n.swaI,h=f.oDLU;if(h.MVWq=r,"activity_time"===(null==f?void 0:f.Bydx)){var _,g,m,p,y=null==f||null===(_=f.FtFx)||void 0===_||null===(_=_.Xqan)||void 0===_?void 0:_.time;(null==f||null===(g=f.DVfz)||void 0===g?void 0:g.length)>0?setTimeout((function(){var t;(null===(t=e.getController())||void 0===t?void 0:t._appEventsNoKpi).length<=2&&f.DVfz===location.pathname&&n._displayCampaign(r)}),y):(null==f||null===(m=f.FtFx)||void 0===m||null===(m=m.Xqan)||void 0===m?void 0:m.nkpi.length)>0?(setTimeout((function(){n.dvMa||(n.muDf=!0,n.muDf&&(n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.swaI.nZSV,n.swaI.nwvy),n.muDf&&(n.swaI.MVWq=r,n.dvMa=!1,u.validate(n.IBTs,n.VNPv)))),f.FtFx.Xqan.nkpi.map((function(e){u.unregisterFromEvent(F(f.FtFx.Xqan.et)+"___"+e,n),n.uIPR=!1}))}),y),f.FtFx.Xqan.nkpi.map((function(e){u.registerForEvent(F(f.FtFx.Xqan.et)+"___"+e,n.UKCS)}))):(null==f||null===(p=f.FtFx)||void 0===p||null===(p=p.Xqan)||void 0===p?void 0:p.kpi.length)>0&&(setTimeout((function(){f.FtFx.Xqan.kpi.map((function(e){u.unregisterFromEvent(F(f.FtFx.Xqan.et)+"___"+e,n)}))}),y),f.FtFx.Xqan.kpi.map((function(e){e===f.oDLU.FtFx.azhd?(u.unregisterFromEvent(I(h.Bydx)+"___"+h.FtFx.azhd,n),u.registerForEvent(F(f.FtFx.Xqan.et)+"___"+e,n.Jiup)):u.registerForEvent(F(f.FtFx.Xqan.et)+"___"+e,n.tNCx)})))}else u.unregisterFromEvent(I(h.Bydx)+"___"+h.FtFx.azhd,n),u.registerForEvent(I(f.Bydx)+"___"+f.FtFx.azhd,n);n.nQEL[i]=Date.now()}})),s(this,"daNu",(function(e,t,i,r){var a=_e.getInstance();I(n.OzZr.Bydx)===e&&n.wxOD(i,n.OzZr.XkIX)&&n.OzZr.FtFx.azhd===t&&n.Fciv(n.OzZr.FtFx.Xqan,r)&&(n.fJuk+=1,n.muDf=n.hzxw(n.fJuk,n.OzZr.nZSV,n.OzZr.nwvy),n.muDf&&(n.OzZr.MVWq=i,a.validateForTermination(n.IBTs,n.VNPv)))})),s(this,"QLKW",(function(e,t,i,r){var a=n.swaI.oDLU,o=I(a.Bydx)===e&&a.FtFx.azhd===t&&n.wxOD(i,a.XkIX)&&n.Fciv(a.FtFx.Xqan,r);return o="APX_PAGE_OPENED"===t?o&&location.pathname===a.FtFx.NZVk:o})),s(this,"wxOD",(function(e,t){var n=Math.ceil(e);return n>t.PLhE&&n<t.vCcl})),s(this,"hzxw",(function(e,t,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(r&&n.swaI.rpwp&&(e+=n.BKLa),i){case"EQ":return e===t;case"GT":return e>t;case"GTE":return e>=t;case"LT":return e<t;case"LTE":return e<=t;default:return!1}})),s(this,"Fciv",(function(e,t){var n=!0;try{var r,a=function(){if(!1===n)return{v:!1};if("object"===i(e[o])){var r,a,s,u=e[o].op,l=e[o].t;if("s"===l)s=e[o].val;else if("l"===l||"f"===l)s=parseFloat(e[o].val);else if("b"===l)switch(e[o].val){case"true":s=!0;break;case"false":s=!1;break;default:s=e[o].val}var d,v=(Array.isArray(t[o])?t[o]:[t[o]]).some((function(e){return"s"===l?e="".concat(e):"l"===l?e=parseInt(e):"f"===l?e=parseFloat(e):"b"===l&&(e=!!e),E(e,s,u)}));if(!(null===(r=e[o])||void 0===r||!r.present)&&(null===(a=e[o])||void 0===a?void 0:a.present))d=!!t.hasOwn(t,o),n=n&&d;n=n&&v}else n=n&&E(t[o],e[o],"EQ")};for(var o in e)if(r=a())return r.v}catch(e){Z.error(e),n=!1}return n})),s(this,"MicF",(function(t,i,r,a,o,s,u,l){var d,v=!1;n.no_KPI_TriggerDetails=e.getController().getFromStorage("apx_nokpi_triggerdetails"),null===n.no_KPI_TriggerDetails||void 0===n.no_KPI_TriggerDetails?n.no_KPI_TriggerDetails=[]:n.no_KPI_TriggerDetails=JSON.parse(n.no_KPI_TriggerDetails);var c,f=0;s&&(f=Date.now()+o);for(var h=0;h<n.no_KPI_TriggerDetails.length;h++)if(n.no_KPI_TriggerDetails[h].id===u){v=!0,d=n.no_KPI_TriggerDetails[h];break}v?d.satisfiedCount+=1:(c={id:u,type:t,time:r,name:i,additionalInfo:a,satisfiedCount:l,timeBased:s,finishTime:f},n.no_KPI_TriggerDetails.push(c)),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(n.no_KPI_TriggerDetails))})),s(this,"pRJD",(function(e){var t,i=new _e,r=c(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(1===(null==a?void 0:a.length)||void 0===(null==a?void 0:a.length))i.unregisterFromEvent(I(null==a?void 0:a.swaI.Bydx)+"___"+(null==a?void 0:a.swaI.FtFx.azhd),n.bBdT);else{var o,s=c(a);try{for(s.s();!(o=s.n()).done;){var u,l=o.value;i.unregisterFromEvent(I(null==l?void 0:l.swaI.Bydx)+"___"+(null==l||null===(u=l.swaI)||void 0===u?void 0:u.FtFx.azhd),n.bBdT)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){r.e(e)}finally{r.f()}}))}return o(t,[{key:"_displayCampaign",value:function(e){var t=_e.getInstance();this.muDf=!0,this.muDf&&(this.fJuk+=1,this.muDf=this.hzxw(this.fJuk,this.swaI.nZSV,this.swaI.nwvy),this.muDf&&(this.swaI.MVWq=e,t.validate(this.IBTs,this.VNPv)))}}]),t}(),Q=window.ApxorLogger,H=o((function t(){var n=this;r(this,t),s(this,"nZSV",0),s(this,"VwDm",0),s(this,"bsMd","SESSION"),s(this,"CPFp",0),s(this,"wJJW",0),s(this,"dsCU",0),s(this,"_enable_repetition_gap",void 0),s(this,"_enable_days_limit",void 0),s(this,"_enable_session_limit",void 0),s(this,"MYUw",void 0),s(this,"AuYO",void 0),s(this,"NVcI",void 0),s(this,"DSLimits",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var i,r,a,o,s,u,l,d;if(n.IBTs=t._id,n.JUah=t.meta,n.nZSV=t.frequency.count,-1===n.nZSV&&(n.nZSV=9999999),n.dsCU=n.nZSV,n.VwDm=t.frequency.time_interval,n.bsMd=t.frequency.validity,n.DSLimits=t.frequency.DSLimits,n.wJJW=t.frequency.ses_lmt,n._enable_session_limit=null===(i=t.frequency)||void 0===i?void 0:i.enable_session_limit,n._enable_session_limit)n.MYUw=null===(u=t.frequency)||void 0===u?void 0:u.session_count;if(n._dayCount=null!==(r=t.frequency)&&void 0!==r&&r.day_lmt?null===(a=t.frequency)||void 0===a?void 0:a.day_lmt:0,n._enable_repetition_gap=!!t.frequency.enable_repetition_gap&&t.frequency.enable_repetition_gap,n._enable_repetition_gap)n._repetitionValue=null===(l=t.frequency)||void 0===l?void 0:l.repetition_gap.val,n._repetitionUnit=null===(d=t.frequency)||void 0===d?void 0:d.repetition_gap.unit;n._enable_days_limit=!(null===(o=t.frequency)||void 0===o||!o.enable_days_limit)&&(null===(s=t.frequency)||void 0===s?void 0:s.enable_days_limit),n._enable_days_limit&&(n.NVcI=t.frequency.days_limit.days?t.frequency.days_limit.days:1,n.AuYO=t.frequency.days_limit.limit);var v=_e.getInstance().getQeState();if(!m(v)||!m(v[t._id]))return!0;if("SESSION"===n.bsMd){if(n.nZSV=parseInt(n.nZSV)-parseInt(v[t._id].SESSION),n.nZSV<=0)return n.ebUV("Session limit reached"),console.warn("Max count limit reached for session:"+t._id),e.getController().isTestDevice()&&k("Maximum overall limit reached for campaign name ".concat(n.JUah.name)),!1}else{if("OVERALL"!==n.bsMd)return Q.info("Invalid config."),!1;if(n.nZSV=parseInt(n.nZSV)-parseInt(v[t._id].OVERALL),n.nZSV<=0)return n.ebUV("Overall limit reached"),console.warn("Max count limit reached for overall:"+t._id),e.getController().isTestDevice()&&k("Maximum overall limit reached for campaign name ".concat(n.JUah.name)),!1}}catch(e){return Q.error(e),!1}return!0})),s(this,"SyFx",(function(){n.nZSV=n.nZSV-1})),s(this,"getFrequencyCount",(function(){return n.nZSV})),s(this,"aCCL",(function(){"SESSION"===n.bsMd&&(n.nZSV=n.dsCU,Q.info("Campaign Limit reset"))})),s(this,"RmMo",(function(t){try{if(n.nZSV<=0)return"OVERALL"===n.bsMd?(n.ebUV("Overall limit reached"),e.getController().isTestDevice()&&k("Maximum overall limit reached for campaign name ".concat(n.JUah.name))):"SESSION"===n.bsMd&&(e.getController().isTestDevice()&&k("Maximum session limit reached for campaign name ".concat(n.JUah.name)),n.ebUV("Session limit reached")),!1;var i=_e.getInstance().getQeState();if(!m(i)||!m(i[t]))return!0;if(n._enable_session_limit)if(parseInt(n.MYUw)-parseInt(i[t].SESSION)<=0)return n.ebUV("Session limit reached"),e.getController().isTestDevice()&&k("Maximum session limit reached for campaign name ".concat(n.JUah.name)),!1;if(n._enable_repetition_gap)if("session"!=n._repetitionUnit){var r=e.getController().getFromStorage("apx-last-shown-times");if(r=JSON.parse(r),!g(L(r,n.IBTs))){var a=L(r,n.IBTs)[n.IBTs];if(Date.now()-a<S(n._repetitionUnit,n._repetitionValue))return n.ebUV("Config does not satisfy time difference              "),e.getController().isTestDevice()&&k("Config does not satisfy time difference for campaign name ".concat(n.JUah.name)),!1}}else{var o=e.getController().getFromStorage("apx-last-shown-session");if(o=JSON.parse(o),!g(L(o,n.IBTs))){var s=L(o,n.IBTs)[n.IBTs];if(e.getController().getFromStorage("apx_retained_session")-s<parseInt(n._repetitionValue))return n.ebUV("Config does not satisfy session difference              "),e.getController().isTestDevice()&&k("Config does not satisfy session difference for campaign name ".concat(n.JUah.name)),!1}}if(0!==n.wJJW&&n.DSLimits)if(parseInt(n.wJJW)-parseInt(i[t].SESSION)<=0)return n.ebUV("Session limit reached"),e.getController().isTestDevice()&&k("Session limit reached for campaign name ".concat(n.JUah.name)),!1;if(0!==n._dayCount){var u,l=b();if(parseInt(n._dayCount)-parseInt((null===(u=i[t])||void 0===u?void 0:u.DATES[l])||0)<=0)return n.ebUV("Day limit reached"),e.getController().isTestDevice()&&k("Day limit reached for campaign name ".concat(n.JUah.name)),!1}if(n.NVcI>0&&n._enable_days_limit){var d=n.NVcI,v=0;if(function(e){for(var t=[],n=new Date,i=0;i<e;i++){var r=new Date(n);r.setDate(n.getDate()-i);var a=String(r.getDate()),o=String(r.getMonth()),s=r.getFullYear();t.push(a+"/"+o+"/"+s)}return t}(d).forEach((function(e){var n;v+=parseInt((null===(n=i[t])||void 0===n?void 0:n.DATES[e])||0)})),v>n.AuYO)return Q.info("Shown Limit Crossed"),e.getController().isTestDevice()&&k("Days limit reached for campaign name ".concat(n.JUah.name)),!1}}catch(e){n.ebUV("Error validating the frequency: ".concat(e)),Q.error("Error validating the frequency:"+e)}return!0})),s(this,"ebUV",(function(t){var i;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.JUah.type?"survey":"campaign",apx_nudge_id:n.IBTs,apx_nudge_name:n.JUah.name,apx_variant_code:n.JUah.isExperiment||n.JUah.only_context?null===(i=n.JUah.attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),Y=window.ApxorLogger,W=o((function e(){var t=this;r(this,e),s(this,"qSGb",[]),s(this,"qcge",0),s(this,"lJFJ",!1),s(this,"xOrB",void 0),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unordered",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t.IBTs=n,t.VNPv=i,t.Vlnz=a,t.syko=r,t.across_sessions=s;var u=[];t.qcge=e.length;try{if(null!=u)return r=null==e?void 0:e.sequence_type,u=t.dyrY(e,t.qcge),"unordered"!==o&&0!==t.VNPv||t.egMV(),t.qSGb}catch(e){return Y.error(e),!1}})),s(this,"dyrY",(function(e,n){for(var i=0;i<n;i++){t.xOrB=new j;try{t.xOrB.initialize(e[i],t.IBTs,t.VNPv,t.syko,t.IbFD,t.across_sessions,"",-1,!1)&&(t.qSGb.push(t.xOrB),t.qSGb.sequence_type=t.syko)}catch(e){Y.error(e)}}return t.qSGb})),s(this,"egMV",(function(){if("ordered"===t.syko||"strictly_ordered"===t.syko)t.qSGb[0].egMV(0);else{var e,n=c(t.qSGb);try{for(n.s();!(e=n.n()).done;){e.value.egMV()}}catch(e){n.e(e)}finally{n.f()}}})),s(this,"pRJD",(function(e){t.xOrB.pRJD(e)}))})),$=o((function e(){var t=this;r(this,e),s(this,"azhd",""),s(this,"KMXB",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i;t.azhd=e.meta.name,t.KMXB=e.meta.type,t._only_context=e.meta.only_context,t._attr=(null===(n=e.meta)||void 0===n?void 0:n.attr)||{},t._isExperiment=null===(i=e.meta)||void 0===i?void 0:i.isExperiment}catch(e){return window.ApxorLogger.error(e),!1}return!0}))})),ee=window.ApxorLogger,te=o((function t(){var n=this;r(this,t),s(this,"olAO",[]),s(this,"_ret_day",{}),s(this,"QRLE",{}),s(this,"hUrt",!1),s(this,"UXfa",!1),s(this,"retainedDaysValidated",!0),s(this,"retainedSessionValidated",!0),s(this,"eventDoneInLT",!1),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.olAO=e.overall_cfg.events,n._ret_day=e.overall_cfg.ret_day,n.QRLE=e.overall_cfg.session,n.hUrt=e.overall_cfg.toggleRetDay,n.UXfa=e.overall_cfg.toggleSession}catch(e){return ee.error(e),!1}return!0})),s(this,"validate",(function(){var t=parseInt(e.getController().getFromStorage("apx_retained_days")),i=parseInt(e.getController().getFromStorage("apx_retained_session"));if(n.hUrt&&!isNaN(t)&&!(t>=n._ret_day.from&&t<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.UXfa&&!isNaN(i)&&!(i>=n.QRLE.from&&i<=n.QRLE.to))return n.retainedSessionValidated=!1,!1;try{for(var r=e.getController().getFromStorage("_apx_lt_count"),a=e.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}(w(a,r)))),s=0;s<n.olAO.length;s++){if(o[n.olAO[s].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(e){ee.error("Failed to validate the lt count:"+e)}return!0}))})),ne=window.ApxorLogger,ie=o((function e(){var t=this;r(this,e),s(this,"fPyP",[]),s(this,"DixG",[]),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(t.fPyP=e.attributes.user,t.DixG=e.attributes.session,!Array.isArray(t.fPyP)||!Array.isArray(t.DixG))return ne.error("No attributes"),!1}catch(e){return ne.error(e),!1}return!0})),s(this,"validate",(function(e,n){return t.rNCO(e,t.fPyP)&&t.rNCO(n,t.DixG)})),s(this,"rNCO",(function(e,t){var n=t.length,i=!0;try{for(var r,a=function(){var n=t[o];if(!e[n.name]||!1===i)return{v:!1};var r=n.operator,a=n.type,s=n.value.map((function(e){return"s"===a?e:"l"===a?parseInt(e):"f"===a?parseFloat(e):void 0})),u=(Array.isArray(e[n.name])?e[n.name]:[e[n.name]]).some((function(e){return s.some((function(t){return E(e,t,r)}))}));i=i&&u},o=0;o<n;o++)if(r=a())return r.v}catch(e){ne.error(e),i=!1}return i}))})),re=o((function t(){var n=this;r(this,t),s(this,"lBrO",e.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"ccZL",1),s(this,"parse",(function(e){try{var t,i,r;if(n.KMXB=null===(t=e.terminate_info.time_based)||void 0===t?void 0:t.type,n._duration_seconds=null===(i=e.terminate_info)||void 0===i?void 0:i.time_based.duration_seconds,n.ccZL=null===(r=e.terminate_info.time_based)||void 0===r?void 0:r.days,n.baAL(e._id))return n.lBrO.persistTerminationInfoLocally(e._id),!1}catch(e){return!1}return!0})),s(this,"baAL",(function(e){var t,i=JSON.parse(n.lBrO.getFromStorage("apx_termination_ID"));if(!i[e]||null===(t=i[e])||void 0===t||!t.startDate)return!1;var r,a=new Date(i[e].startDate),o=new Date((r=new Date).getMonth()+"/"+r.getDate()+"/"+r.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var e=new Date;return{hours:e.getHours(),mins:e.getMinutes()}}(),l=i[e].mCcj;return s===n.ccZL&&u.hours>=l.hours||s>n.ccZL||i[e].goalAcheived}))})),ae=o((function e(){var t=this;r(this,e),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"DJVe",new ie),s(this,"rfQg",new re),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,i,r;if(t.enable_time_based=null==e||null===(n=e.terminate_info)||void 0===n?void 0:n.enable_time_based,t.enable_time_based&&!t.rfQg.parse(e))return!1;if(t.enable_goal_events=null==e||null===(i=e.terminate_info)||void 0===i?void 0:i.enable_goal_events,t.enable_attributes=null==e||null===(r=e.terminate_info)||void 0===r?void 0:r.enable_attributes,t.enable_attributes&&!t.DJVe.parse(e.terminate_info))return!1}catch(e){return window.ApxorLogger.error(e),!1}return!0})),s(this,"validate",(function(e,n){return t.DJVe.validate(e,n)}))})),oe=window.ApxorLogger,se=o((function t(){var n=this;r(this,t),s(this,"NALX",-1),s(this,"fXSQ",-1),s(this,"mCcj",-1),s(this,"OAbD",-1),s(this,"YBOp",-1),s(this,"LAxR",-1),s(this,"_is_user_timezone",void 0),s(this,"wtXT",!1),s(this,"cimP",!1),s(this,"_nudge_expired",!1),s(this,"_not_yet_active",!1),s(this,"_not_in_specified_time",!1),s(this,"_days_in_week",[]),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,i;if(n.IBTs=e._id,n.JUah=e.meta,isNaN(Date.parse(e.validity.start_date))||isNaN(Date.parse(e.validity.end_date))||!Array.isArray(e.validity.days_in_week))return oe.error("Not valid dates"),!1;if(n.NALX=Date.parse(e.validity.start_date),n.fXSQ=Date.parse(e.validity.end_date),n._days_in_week=null!==(t=e.validity)&&void 0!==t&&t.days_in_week?null===(i=e.validity)||void 0===i?void 0:i.days_in_week:[1,2,3,4,5,6,7],n._is_user_timezone=!e.is_user_timezone||e.is_user_timezone,m(e.at_specific_time)&&(n.wtXT=e.at_specific_time,n.wtXT&&m(e.time_limits)&&(n.mCcj=e.time_limits.start_time,n.OAbD=e.time_limits.end_time,x(n.mCcj)||x(n.OAbD))))return oe.error("Not valid times"),!1;if(m(e.time_excludes_in_day)&&(n.cimP=e.time_excludes_in_day,n.cimP&&m(e.time_excludes)&&(n.YBOp=e.time_excludes.start_time,n.LAxR=e.time_excludes.end_time,x(n.YBOp)||x(n.LAxR))))return oe.error("Not valid exclude times"),!1}catch(e){return oe.error(e),!1}return!0})),s(this,"validate",(function(){var t=Date.now(),i=(new Date).getDay()+1,r=function(e){var t=new Date,n=t.getHours(),i=t.getMinutes(),r=(n=(n<10?"0":"")+n)+":"+(i=(i<10?"0":"")+i);if(!e){var a=t.getUTCHours(),o=t.getUTCMinutes();r=(a=(a<10?"0":"")+a)+":"+(o=(o<10?"0":"")+o)}return r}(n._is_user_timezone);if(t>n.NALX&&t<n.fXSQ&&n._days_in_week.includes(i))return!n.wtXT||D(r,n.mCcj,"GT")&&D(r,n.OAbD,"LT")||(n._not_in_specified_time=!0),n.cimP&&function(e,t,n){var i=u(e.split(":").map(Number),2),r=i[0],a=i[1],o=u(t.split(":").map(Number),2),s=o[0],l=o[1],d=u(n.split(":").map(Number),2),v=60*d[0]+d[1];return v>=60*r+a&&v<=60*s+l}(n.YBOp,n.LAxR,r)?(n.ebUV("Exclude Time limits check failed"),e.getController().isTestDevice()&&k("Exclude Time Limits check failed for campaign name ".concat(n.JUah.name)),!1):!n.wtXT||D(r,n.mCcj,"GT")&&D(r,n.OAbD,"LT");if(t<n.NALX)n._not_yet_active=!0;else if(t>n.fXSQ)n._nudge_expired=!0;else if(!n._days_in_week.includes(i))return n.ebUV("Current week day did not match with Configured Week day"),e.getController().isTestDevice()&&k("Current week day did not match with Configured Week day for campaign name ".concat(n.JUah.name)),!1;return!1})),s(this,"ebUV",(function(t){var i;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.JUah.type?"survey":"campaign",apx_nudge_id:n.IBTs,apx_nudge_name:n.JUah.name,apx_variant_code:n.JUah.isExperiment||n.JUah.only_context?null===(i=n.JUah.attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),ue=o((function e(){var t=this;r(this,e),s(this,"GzzE",""),s(this,"MSjx",""),s(this,"bvaN",""),s(this,"HjFI",""),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return t.GzzE=null==e?void 0:e.screen_binding,!t.GzzE||(t.MSjx=null==e?void 0:e.binding.url,t.bvaN=null==e?void 0:e.binding.var,t.HjFI=null==e?void 0:e.binding.operator,!0)}catch(e){return window.ApxorLogger.error(e),!1}})),s(this,"validate",(function(){var e=t.MSjx,n=t.bvaN,i=t.HjFI,r=window.location.href;return!t.GzzE||("EQ"===i?e.includes(n)?!!C(r,e,n,!1):r===e:"SW"===i?e.includes(n)?!!C(r,e,n,!0):!!r.startsWith(e):void 0)}))})),le=window.ApxorLogger,de=o((function t(){var i=this;r(this,t),s(this,"uGcV",[]),s(this,"ilwx",[]),s(this,"IBTs",""),s(this,"JUah",new $),s(this,"YtGg",new O),s(this,"bsMd",new se),s(this,"CAYu",new H),s(this,"oYQX",new te),s(this,"aHjs",new ae),s(this,"pzhD",new ue),s(this,"syko",!1),s(this,"IbFD",[]),s(this,"_variant_code",""),s(this,"lJFJ",!1),s(this,"groupCombineOperator","OR"),s(this,"dvMa",!1),s(this,"BgyN",!1),s(this,"uzoo",void 0),s(this,"timeForKPI",void 0),s(this,"kpiIndex",0),s(this,"MdLH",void 0),s(this,"_across_sessions",!1),s(this,"NuSE",void 0),s(this,"PxAW",!1),s(this,"hKNa",void 0),s(this,"dZyn",void 0),s(this,"vXoL",void 0),s(this,"JAcD",void 0),s(this,"dHXt",void 0),s(this,"AJnY",void 0),s(this,"BcmK",void 0),s(this,"GOEA",void 0),s(this,"kwQE",void 0),s(this,"cwjd",void 0),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t,n;if(!m(e._id))return le.error("No Id"),!1;if(!m(e.enabled)||!e.enabled)return le.error("Not enabled"),!1;if(!(i.JUah.parse(e)&&i.bsMd.parse(e)&&i.CAYu.parse(e)&&i.YtGg.parse(e)&&i.oYQX.parse(e)&&i.aHjs.parse(e)&&i.pzhD.parse(e)))return!1;if(i._variant_code=i.JUah._isExperiment||i.JUah._only_context?null===(t=i.JUah._attr)||void 0===t?void 0:t.apx_variant_code:"TG",i._across_sessions=!(null==e||!e.across_sessions)&&(null==e?void 0:e.across_sessions),i.enable_conditions=null==e?void 0:e.enable_conditions,i.enable_conditions_v2=null==e?void 0:e.enable_conditions_v2,!m(e.conditions)||!Array.isArray(e.conditions))return le.error("No valid conditions",e.conditions),!1;i.IBTs=e._id,i.syko=!!m(e.sequence_enabled)&&e.sequence_enabled,m(e.conditions_v2)&&i.enable_conditions_v2&&(i.syko=null==e?void 0:e.sequence_type),!0===i.syko&&e.conditions.sort((function(e,t){return e.sequence<t.sequence})),m(e.conditions_v2)&&i.enable_conditions_v2?(n=e.conditions_v2,i.PxAW=!0):n=e.conditions,i.NuSE=n;var r=n.length,a=null==e?void 0:e.no_context_enabled;if(0===r&&a&&setTimeout((function(){i.ThiM()}),10),i.cwjd=r,i.jCnx(n,r),i.olyw(),i.aHjs.enable_goal_events)for(var o=e.terminate_info.goal_events.events,s=o.length,u=0;u<s;u++){var l=new j;l.initialize(o[u],i.IBTs,u,!0,[],i._across_sessions,"termination")&&i.ilwx.push(l)}return i.uGcV.length>0}catch(e){return le.error(e),!1}})),s(this,"jCnx",(function(e,t){for(var n=function(){i.IbFD=[];var t=e[r];if("group"===(null!=t&&t.condition_type?null==t?void 0:t.condition_type:"single")){var n=t.conditions_v2;i.groupCombineOperator=t.combine_operator;var a=null==t?void 0:t.sequence_type;i.kwQE=new W;var o=i.kwQE.initialize(n,i.IBTs,r,a,i.IbFD,i.syko,i._across_sessions);i.uGcV.push(o)}else{if("didn't"===t.type){var s,u={trigger_key:t.trigger.details.name,no_kpi_array:null==t||null===(s=t.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==t?void 0:t._id,time_bounds:t.time_bounds.upper};i.IbFD=[].concat(l(i.IbFD),[u])}if(i.kwQE=new j,i.kwQE.initialize(t,i.IBTs,r,i.syko,i.IbFD,i._across_sessions)){i.uGcV.push(i.kwQE);var d=(null==t?void 0:t.timeout)/(null==t?void 0:t.findinterval),v=(null==t?void 0:t.frameid)||"",c=null==t?void 0:t.url;window.location.href===c&&"view_visibility"===t.event_type&&!0===B(t.view_id,v,null==t?void 0:t.enable_retry,null==t?void 0:t.findinterval,d)&&i.ThiM(!0),window.addEventListener("navigate",(function(e){var n=null==t?void 0:t.url;window.location.href===n&&"view_visibility"===t.event_type&&!0===B(t.view_id,v,null==t?void 0:t.enable_retry,null==t?void 0:t.findinterval,d)&&i.ThiM(!0)}))}}},r=0;r<t;r++)n()})),s(this,"olyw",(function(){if(i._across_sessions&&"ordered"===i.syko){var t=!1,n=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(n=JSON.parse(n))&&null!=n)for(var r=function(e){var r,a,o;if(null!==(r=i.uGcV[e])&&void 0!==r&&null!==(r=r.swaI)&&void 0!==r&&r._timeEnabled&&void 0===i.uGcV[e].length){if("didn't"===i.uGcV[e].swaI.KMXB){var s=i.uGcV[e].swaI._id,u=i.fysA(s,n);if(u)if(Date.now()>u.finishTime)i.uGcV[e].muDf=!0,i.uGcV[e].fJuk=u.satisfiedCount,t=!0;else{var l=u.finishTime-Date.now(),d=i.uGcV[e].swaI._eventCategory?i.uGcV[e].swaI._eventCategory:"specific_event",v=new _e;"specific_event"===d?(v.registerForEvent(I(i.uGcV[e].swaI.Bydx)+"___"+i.uGcV[e].swaI.FtFx.azhd,i.UKCS),i.dHXt=i.uGcV[e]):i.aqBD(d),setTimeout((function(){e!==i.uGcV.length-1||i.dvMa||(i.uGcV[e].muDf=!0,i.uGcV[e].fJuk=u.satisfiedCount,t=!0,"specific_event"===d?v.unregisterFromEvent(I(i.uGcV[e].swaI.Bydx)+"___"+i.uGcV[e].swaI.FtFx.azhd,i.UKCS):i.SDtv(i.uGcV[e]),i.ThiM())}),l)}}if("did"===i.uGcV[e].swaI.KMXB){var c=i.uGcV[e].swaI._id,f=i.fysA(c,n);if(f)if(null==f.satisfiedCount){if(Date.now()<f.finishTime){i.vXoL=f,i.dZyn=e;var h=f.finishTime-Date.now(),_=i.uGcV[e].swaI._eventCategory?i.uGcV[e].swaI._eventCategory:"specific_event",g=new _e;"specific_event"===_?g.registerForEvent(I(i.uGcV[e].swaI.Bydx)+"___"+i.uGcV[e].swaI.FtFx.azhd,i.SVXa):i.aqBD(_),setTimeout((function(){"specific_event"===_?g.unregisterFromEvent(I(i.uGcV[e].swaI.Bydx)+"___"+i.uGcV[e].swaI.FtFx.azhd,i.SVXa):i.SDtv(i.uGcV[e])}),h)}}else i.uGcV[e].fJuk=f.satisfiedCount,i.uGcV[e].muDf=!0}}else t=i.Zcjp(e,n);t&&(null===(a=i.uGcV[e])||void 0===a||null===(a=a.swaI)||void 0===a||!a._timeEnabled||(null===(o=i.uGcV[e])||void 0===o?void 0:o.length)>1)?e===i.uGcV.length-1&&i.ThiM():t||void 0===!i.uGcV[e].length&&i.uGcV[e].egMV()},a=0;a<i.uGcV.length;a++)r(a)}else if(i._across_sessions&&"unordered"===i.syko){var o=e.getController().getFromStorage("apx_nokpi_triggerdetails");if(null!=(o=JSON.parse(o))&&null!=o)for(var s=0;s<i.uGcV.length;s++)i.Zcjp(s,o)}})),s(this,"Zcjp",(function(e,t){if(void 0===i.uGcV[e].length||1===i.uGcV[e].length){var n=i.uGcV[e].swaI._id,r=!1,a=i.fysA(n,t);if(a)i.hKNa=a,r=(new j).hzxw(a.satisfiedCount,i.uGcV[e].swaI.nZSV,i.uGcV[e].swaI.nwvy),a&&(r?i.uGcV[e].muDf=!0:i.uGcV[e].fJuk=a.satisfiedCount);else i.uGcV[e].egMV();return r}if(i.uGcV[e].length>=1){var o,s,u;if("ordered"===(s=null===(o=i.uGcV[e])||void 0===o?void 0:o.sequence_type)||"strictly_ordered"===s){for(var l=0;l<i.uGcV[e].length;l++){var d=i.uGcV[e][l],v=d.swaI._id;u=!1;var c=i.fysA(v,t);if(c){if(u=(new j).hzxw(c.satisfiedCount,d.swaI.nZSV,d.swaI.nwvy),c)if(u){i.uGcV[e][l].muDf=!0;var f=l+1,h=i.uGcV[e][l+1];void 0===h&&m(i.uGcV[e+1])&&(i.uGcV[e+1].egMV(),u=!0),null!=h&&i.uGcV[e][l+1].egMV(f)}else i.uGcV[e][l].fJuk=c.satisfiedCount}else(m(i.uGcV[e][l-1])&&!0===i.uGcV[e][l].muDf||_(i.uGcV[e][l-1]))&&i.uGcV[e][l].egMV()}return u}for(var g,p=0;p<i.uGcV[e].length;p++){var y=i.uGcV[e][0].swaI.CMvH;g="OR"!==y;var w=i.uGcV[e][p],x=w.swaI._id;u=!1;var I=i.fysA(x,t);if(I)u=(new j).hzxw(I.satisfiedCount,w.swaI.nZSV,w.swaI.nwvy),I&&(u?i.uGcV[e][p].muDf=!0:i.uGcV[e][p].fJuk=I.satisfiedCount);else w.egMV();g="AND"===y?g&&u:g||u}return g}})),s(this,"fysA",(function(e,t){return t.find((function(t){return t.id===e}))})),s(this,"rbXP",(function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=_e.getInstance();if(!(t<0)){var a=i.uGcV[t],o="unordered";if((null==a?void 0:a.length)>1&&(o=null==a?void 0:a.sequence_type),!0===i.syko||"ordered"===i.syko||"strictly_ordered"===i.syko||"ordered"===o||"strictly_ordered"===o){i.kpiIndex=t+1;var s=i.uGcV[t];if((null==s?void 0:s.length)>0){if(m(s))if("unordered"===i.syko&&"ordered"===o){var u=a[n-1];if(m(u))if(void 0===u.length||1==u.length){if(!u.muDf)return}else if(u.length>1&&!i.RpRo(u))return;var l,d=a[n+1];if(m(d)){if(d.egMV(n+1),"strictly_ordered"===i.syko){i._currentEventname=s[n].swaI.FtFx.azhd;var v=e.getController();v.registerForEvent("APP_EVENT",i.kVCV),v.registerForEvent("CLIENT_EVENT",i.kVCV)}}else if("strictly_ordered"===o)1!=i.lJFJ&&i.ThiM();else(null===(l=a[n])||void 0===l?void 0:l.length)>0?i.RpRo(a)&&i.ThiM():i.ThiM()}else{var f,h=i.uGcV[t-1];if(m(h))if(void 0===h.length||1==h.length){if(!h.muDf)return}else if(h.length>1&&!i.RpRo(h))return;if(void 0===s.length||1===s.length?f=i.uGcV[t+1]:s.length>1&&("ordered"===o||"strictly_ordered"===o?f=n===s.length-1?i.uGcV[t+1]:i.uGcV[t][n+1]:i.RpRo(s)&&(f=i.uGcV[t+1])),m(f)){if(void 0===f.length||1===f.length)f.egMV(n+1);else if(i.RpRo(s))if(void 0===f.length)f.egMV();else if(f.length>1)if("unordered"===f.sequence_type)for(var _=0;_<f.length;_++)f[_].egMV(_);else"ordered"!==f.sequence_type&&"strictly_ordered"!==f.sequence_type||f[0].egMV(0);if("strictly_ordered"===i.syko){i._currentEventname=s[n].swaI.FtFx.azhd;var g=e.getController();g.registerForEvent("APP_EVENT",i.kVCV),g.registerForEvent("CLIENT_EVENT",i.kVCV)}}else"strictly_ordered"===i.syko?1!=i.lJFJ&&i.ThiM():i.RpRo(s)&&i.ThiM()}}else if(m(s)&&s.muDf){s.nQEL[s.swaI.FtFx.azhd]=Date.now();var p=i.uGcV[t-1];if(m(p))if(void 0===p.length||1==p.length){if(!p.muDf)return}else if(p.length>1&&!i.RpRo(p))return;var y=i.uGcV[t+1];if(m(y)){var w,x;if(null!=y&&null!==(w=y.swaI)&&void 0!==w&&w._timeEnabled){if("session"!=(null===(x=y.swaI)||void 0===x?void 0:x._time.unit)){var F,E,V=S(y.swaI._time.unit,y.swaI._time.value);if("didn't"==(null===(F=y.swaI)||void 0===F?void 0:F.KMXB)){if(i.BcmK=setTimeout((function(){if(i.dvMa)i.dvMa=!1;else{if(i.dvMa=!1,y.muDf=!0,y.muDf){y.fJuk+=1;var e=new j;if(y.muDf=e.hzxw(y.fJuk,y.swaI.nZSV,y.swaI.nwvy),y.muDf){y.swaI.MVWq=Date.now();var n=t+1,a=i.uGcV[n+1];m(a)?a.egMV():i.ThiM()}}r.unregisterFromEvent(I(y.swaI.Bydx)+"___"+y.swaI.FtFx.azhd,i.UKCS),y.uIPR=!1}}),V),i._across_sessions){var b=S(y.swaI._time.unit,y.swaI._time.value),D=y.swaI._timeEnabled,C=y.swaI._id,B=new j;B.MicF(y.swaI.KMXB,y.swaI.FtFx.azhd,Date.now(),y.swaI.FtFx.Xqan,b,D,C)}"specific_event"===y.swaI._eventCategory?(r.registerForEvent(I(y.swaI.Bydx)+"___"+y.swaI.FtFx.azhd,i.UKCS),i.dHXt=y):i.aqBD(y)}else if("did"==(null===(E=y.swaI)||void 0===E?void 0:E.KMXB)&&(i.dvMa=!1,i.MdLH=y,m(i.uGcV[t+2])&&i._across_sessions&&(i.JAcD=i.uGcV[t+2]),i.GOEA=setTimeout((function(){i.dvMa?i.dvMa=!1:(i.dvMa=!1,r.unregisterFromEvent(I(y.swaI.Bydx)+"___"+y.swaI.FtFx.azhd,i.tNCx))}),V),i.uzoo=s,i.timeForKPI=V,r.registerForEvent(I(y.swaI.Bydx)+"___"+y.swaI.FtFx.azhd,i.tNCx),i.AJnY=y,i._across_sessions)){var T=S(y.swaI._time.unit,y.swaI._time.value),M=y.swaI._timeEnabled,U=y.swaI._id,A=new j;A.MicF(y.swaI.KMXB,y.swaI.FtFx.azhd,Date.now(),y.swaI.FtFx.Xqan,T,M,U)}}}else if(y.length>0)if("ordered"===y.sequence_type||"strictly_ordered"===y.sequence_type)y[0].egMV(n+1);else{var L,G=c(y);try{for(G.s();!(L=G.n()).done;){var k=L.value;k.egMV()}}catch(e){G.e(e)}finally{G.f()}}else y.egMV();if("strictly_ordered"===i.syko){i._currentEventname=s.swaI.FtFx.azhd;var J=e.getController();J.registerForEvent("APP_EVENT",i.kVCV),J.registerForEvent("CLIENT_EVENT",i.kVCV)}}else"strictly_ordered"===i.syko?1!=i.lJFJ&&i.ThiM():i.ThiM()}}else i.kzEu(),i.ThiM()}})),s(this,"kVCV",(function(e){e&&e.name!=i._currentEventname&&(i.lJFJ=!0)})),s(this,"aqBD",(function(e){var t=new _e,n=e.swaI._eventCategory;"apxor_event"===n?t.registerForEvent("apxor_event",i.UKCS):"customer_event"===n?t.registerForEvent("customer_event",i.UKCS):"any_event"===n?t.registerForEvent("any_event",i.UKCS):"campaign_event"===n?t.registerForEvent("campaign_event",i.UKCS):"survey_event"===n&&t.registerForEvent("survey_event",i.UKCS)})),s(this,"SDtv",(function(e){var t=new _e,n=e.swaI._eventCategory;"apxor_event"===n?t.unregisterFromEvent("apxor_event",i.UKCS):"customer_event"===n?t.unregisterFromEvent("customer_event",i.UKCS):"any_event"===n?t.unregisterFromEvent("any_event",i.UKCS):"campaign_event"===n?t.unregisterFromEvent("campaign_event",i.UKCS):"survey_event"===n&&t.unregisterFromEvent("survey_event",i.UKCS)})),s(this,"UKCS",(function(){var e,t;i.BcmK&&(i.dvMa=!1,clearTimeout(i.BcmK));var n=new _e;i.dvMa=!0,i._across_sessions&&null!==localStorage.getItem("apx_nokpi_triggerdetails")&&localStorage.removeItem("apx_nokpi_triggerdetails"),n.unregisterFromEvent(I(null===(e=i.dHXt)||void 0===e||null===(e=e.swaI)||void 0===e?void 0:e.Bydx)+"___"+(null===(t=i.dHXt)||void 0===t||null===(t=t.swaI)||void 0===t||null===(t=t.FtFx)||void 0===t?void 0:t.azhd),i.UKCS)})),s(this,"tNCx",(function(){var t,n,r,a=new _e;i.dvMa=!0,i.GOEA&&clearTimeout(i.GOEA);var o=new j;if(i.MdLH.fJuk+=1,i.MdLH.muDf=o.hzxw(i.MdLH.fJuk,i.MdLH.swaI.nZSV,i.MdLH.swaI.nwvy),a.unregisterFromEvent(I(null===(t=i.AJnY)||void 0===t||null===(t=t.swaI)||void 0===t?void 0:t.Bydx)+"___"+(null===(n=i.AJnY)||void 0===n||null===(n=n.swaI)||void 0===n?void 0:n.FtFx.azhd),i.tNCx),i._across_sessions&&null!==(r=i.JAcD)&&void 0!==r&&r.swaI._timeBased){var s,u,l,d=e.getController().getFromStorage("apx_nokpi_triggerdetails");d=null==d?[]:JSON.parse(d);for(var v=0;v<d.length;v++)if(i.no_KPI_TriggerDetails[v].id===i.JAcD.swaI._id){s=!0,u=d[v];break}if(s)u.satisfiedCount+=1;else{var c=i.MdLH.swaI._id,f=i.MdLH.swaI.KMXB,h=i.MdLH.swaI.FtFx.azhd,_=i.MdLH.swaI.FtFx.Xqan;l={id:c,type:f,time:Date.now(),name:h,additionalInfo:_,satisfiedCount:i.MdLH.swaI._timeEnabled,timeBased:i.MdLH.swaI._timeEnabled},i.no_KPI_TriggerDetails.push(l)}}if(i.MdLH.muDf){var g=i.uGcV[i.kpiIndex+1];m(g)?g.egMV():i.ThiM()}})),s(this,"SVXa",(function(){if(i.dZyn===i.uGcV.length-1){i.BgyN=!0;i.uGcV[i.dZyn]&&(i.uGcV[i.dZyn].fJuk=i.vXoL.satisfiedCount,i.uGcV[i.dZyn].muDf=!0,i.ThiM())}else{var t,n,r=e.getController().getFromStorage("apx_nokpi_triggerdetails");r=null==r?[]:JSON.parse(r);for(var a=0;a<r.length;a++)if(r[a].id===i.dZyn){n=!0,t=r[a];break}if(n&&(t.satisfiedCount=1),e.getController().persistToStorage("apx_nokpi_triggerdetails",JSON.stringify(r)),i.uGcV[i.dZyn].fJuk=i.vXoL.satisfiedCount,i.uGcV[i.dZyn].muDf=!0,i.uGcV[i.dZyn+1].swaI._timeEnabled){var o=S(i.uGcV[i.dZyn+1].swaI._time.unit,i.uGcV[i.dZyn+1].swaI._time.value),s=i.uGcV[i.dZyn+1].swaI._timeEnabled,u=i.uGcV[i.dZyn+1].swaI._id,l=i.uGcV[i.dZyn+1].fJuk,d=i.uGcV[i.dZyn+1].swaI.FtFx.azhd,v=i.uGcV[i.dZyn+1].FtFx.Xqan;(new j).MicF(i.swaI.KMXB,d,Date.now(),v,o,s,u,l)}}})),s(this,"kzEu",(function(){if(i._across_sessions&&i.PxAW){var t,n,r,a="single",o=!1,s=e.getController().getFromStorage("apx_nokpi_triggerdetails");if((s=JSON.parse(s)).length>0){var u,l=c(s);try{var d=function(){var e=u.value,s=e.id,l=e.satisfiedCount;if(t=i.uGcV.find((function(e,t){if(1===(null==e?void 0:e.length)||void 0===(null==e?void 0:e.length)){if(e.swaI._id===s)return a="single",n=t,!0}else if(e.length>0){var i=e.findIndex((function(e){return e.swaI._id===s}));if(-1!==i)return n=t,r=i,a="group",!0}return!1})),"single"===a&&t){var d=new j;o=d.hzxw(l,t.swaI.nZSV,t.swaI.nwvy);var v=i.uGcV.findIndex((function(e){var t;return(null==e||null===(t=e.swaI)||void 0===t?void 0:t._id)===s}));void 0===v&&(v=n),o&&(i.uGcV[v].muDf=!0)}else if("group"===a&&t){var c=new j;(o=c.hzxw(l,t[r].swaI.nZSV,t[r].swaI.nwvy))&&(i.uGcV[n][r].muDf=!0)}};for(l.s();!(u=l.n()).done;)d()}catch(e){l.e(e)}finally{l.f()}}}})),s(this,"cROt",(function(e){e<0||i.lrXz()})),s(this,"ThiM",(function(){var t,r,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=e.getController().getUserAttributes(),s=e.getController().getSessionAttributes();if(null!==(t=window.ApxorRTM)&&void 0!==t&&t.isBadgePresent&&null!==(r=window.ApxorRTM)&&void 0!==r&&r.badgesLists.includes(i.IBTs)&&e.getController().isBadgeTriggerSatisfied(i.IBTs)||null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.JUah.KMXB?"survey":"campaign",apx_nudge_id:i.IBTs,apx_nudge_name:i.JUah.azhd,apx_variant_code:i.JUah._isExperiment||i.JUah._only_context?i.JUah._attr.apx_variant_code:"TG"}),!(i.bsMd.validate()&&i.YtGg.validate(o,s)&&i.oYQX.validate()&&i.pzhD.validate())){i.JUah.KMXB;return i.oYQX.retainedDaysValidated?i.oYQX.retainedSessionValidated?i.oYQX.eventDoneInLT?void i.ebUV("Event done in life time"):i.YtGg.userAttributesValidated?i.YtGg.sessionAttributeValidated?i.bsMd._not_in_specified_time?void i.ebUV("Time limits check failed"):i.bsMd._not_yet_active?void i.ebUV("not in the scheduled time"):i.bsMd._nudge_expired?void i.ebUV("nudge expired"):void 0:void i.ebUV("Session property filter not met"):void i.ebUV("User property filter not met"):void i.ebUV("User session criteria not met"):void i.ebUV("Retained day criteria not met")}var u=i.uGcV.length,l=u<1,d="";0===u&&(l=!0);for(var v=0;v<u;v++){var f=void 0,h=i.uGcV[v];if(h.length>1){var _=h[0].swaI.CMvH;f="AND"===_;for(var g=0;g<h.length;g++){var m=h[0].swaI.CMvH;f="AND"===m?f&&h[g].muDf:f||h[g].muDf}}else f=h.muDf;if(""===d.trim())l=f;else switch(d){case"AND":l=l&&f;break;case"OR":l=l||f}d=h.length>1?i.groupCombineOperator:h.CMvH}if(!0===a&&(l=!0),l){var p,y;if(console.debug("onCondition satisfied"),!i.CAYu.RmMo(i.IBTs))return void console.warn("Maximum limit reached",i.IBTs);if(!(null!==(p=window.ApxorRTM)&&void 0!==p&&p.isBadgePresent&&null!==(y=window.ApxorRTM)&&void 0!==y&&y.badgesLists.includes(i.IBTs)&&e.getController().isBadgeTriggerSatisfied(i.IBTs))){var w="SURVEY"===i.JUah.KMXB?"survey":"campaign";null==e||e.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.JUah.KMXB?"survey":"campaign",apx_nudge_id:i.IBTs,apx_nudge_name:i.JUah.azhd,apx_variant_code:i.JUah._isExperiment||i.JUah._only_context?i.JUah._attr.apx_variant_code:"TG"},!1,"",w)}i._across_sessions&&localStorage.removeItem("apx_nokpi_triggerdetails");var x,I=c(i.uGcV);try{for(I.s();!(x=I.n()).done;){var F=x.value;if(1===(null==F?void 0:F.length)||void 0===(null==F?void 0:F.length))F.muDf=!1,F.fJuk=0;else{var E,V=c(F);try{for(V.s();!(E=V.n()).done;){var b=E.value;b.muDf=!1,b.fJuk=0}}catch(e){V.e(e)}finally{V.f()}}}}catch(e){I.e(e)}finally{I.f()}if(i.kwQE.pRJD(i.uGcV),i.uGcV=[],i.jCnx(i.NuSE,i.cwjd),!0===i.JUah._only_context){var D="SURVEY"===i.JUah.KMXB?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.JUah._attr),{},{message_name:i.JUah.azhd,id:i.IBTs}),!1,"",D)}e.getController().dispatchEvent(i.JUah.KMXB,{name:i.JUah.KMXB,additional_info:{uuid:i.IBTs,name:i.JUah.azhd}})}})),s(this,"lrXz",(function(){for(var t=i.ilwx.length,r=t<1,a="",o=0;o<t;o++){var s=i.ilwx[o],u=s.muDf;if(""===a.trim())r=u;else switch(a){case"AND":r=r&&u;break;case"OR":r=r||u}a=s.KddY}if(r){if(e.getController().persistTerminationInfoLocally(i.IBTs),!0===i.JUah._only_context){var l="SURVEY"===i.JUah.KMXB?"survey":"campaign";e.logEvent("apx_context_evaluated",n(n({},i.JUah._attr),{},{message_name:i.JUah.azhd,id:i.IBTs}),!1,"apxor",l)}e.getController().dispatchEvent(i.JUah.KMXB,{name:i.JUah.KMXB,additional_info:{uuid:i.IBTs,name:i.JUah.azhd}})}})),s(this,"validateForTerminationAttributes",(function(){var t=e.getController().getUserAttributes(),n=e.getController().getSessionAttributes();return i.aHjs.validate(t,n)})),s(this,"SyFx",(function(){i.CAYu.SyFx()})),s(this,"getFrequencyCount",(function(){return i.CAYu.getFrequencyCount()})),s(this,"rBuj",(function(){return i.CAYu.aCCL()})),s(this,"RpRo",(function(e){var t;t="AND"===e[0].swaI.CMvH;for(var n=0;n<e.length;n++){t="AND"===e[0].swaI.CMvH?t&&e[n].muDf:t||e[n].muDf}return t})),s(this,"ebUV",(function(t){var n;null==e||e.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===i.JUah.KMXB?"survey":"campaign",apx_nudge_id:i.IBTs,apx_nudge_name:i.JUah.azhd,apx_variant_code:i.JUah._isExperiment||i.JUah._only_context?null===(n=i.JUah._attr)||void 0===n?void 0:n.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:t})}))})),ve=o((function e(){var t=this;r(this,e),s(this,"duar",{}),s(this,"parse",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(m(e)&&m(e.configs)){var n=e.configs;if(!Array.isArray(n))return;n.sort((function(e,t){var n,i;return(null!==(n=e.prio)&&void 0!==n?n:-1)-(null!==(i=t.prio)&&void 0!==i?i:-1)}));for(var i=0;i<n.length;i++){var r=n[i],a=r._id,o=new de;o.parse(r)?t.duar[a]=o:console.warn("Failed to parse cfg",a)}}})),s(this,"validate",(function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t.duar[e]){var r=t.duar[e];r.rbXP(n,i)}})),s(this,"getVariantCode",(function(e){return t.duar[e]?t.duar[e]._variant_code:""})),s(this,"validateForTermination",(function(e,n){t.duar[e]&&t.duar[e].cROt(n)})),s(this,"validateForTerminationAttributes",(function(e){return!!t.duar[e]&&t.duar[e].validateForTerminationAttributes()})),s(this,"SyFx",(function(e){t.duar[e].SyFx()})),s(this,"getFrequencyCount",(function(e){var n=t.duar[e];if(null!=n)return n.getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var e=t.duar;for(var n in e)e[n].rBuj()})),s(this,"Tavd",(function(e){try{if(t.duar){var n=t.duar[e];if(n&&n.JUah)return n.JUah}}catch(e){console.log("Error in getting the campaign meta ".concat(e))}return{}}))})),ce=window.ApxorLogger,fe=o((function t(){var n=this;r(this,t),s(this,"iawS",{}),s(this,"kFVq",[]),s(this,"FfEt",!1),s(this,"initialize",(function(){var t=e.getController();t.registerForEvent("APP_EVENT",(function(e){return n.tLdE(e,"AE")})),t.registerForEvent("CLIENT_EVENT",(function(e){return n.tLdE(e,"CE")}))})),s(this,"Lyjr",(function(){for(var e in n.kFVq)n.tDxK(e.event,e.key,e.type);n.FfEt=!0})),s(this,"pnCQ",(function(e,t){var i;"function"==typeof t&&((i=n.iawS[e]?n.iawS[e]:[]).push(t),n.iawS[e]=i,ce.debug("Listeners list: ",n.iawS))})),s(this,"unregisterFromEvent",(function(e,t){if(n.iawS[e]){for(var i=n.iawS[e],r=[],a=0;a<i.length;a++){var o=i[a];o!==t&&r.push(o)}n.iawS[e]=r}})),s(this,"tLdE",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE";n.tDxK(e,"any_event",t),"apxor"===(null==e?void 0:e.loggedBy)?n.tDxK(e,"apxor_event",t):"customer"===(null==e?void 0:e.loggedBy)&&n.tDxK(e,"customer_event",t),"campaign"===(null==e?void 0:e.apx_nudge_type)?n.tDxK(e,"campaign_event",t):"survey"===(null==e?void 0:e.apx_nudge_type)&&n.tDxK(e,"survey_event",t);var i=t+"___"+e.name;n.tDxK(e,i,t)})),s(this,"tDxK",(function(t,i,r){if(n.FfEt){if(ce.debug("Notifying listeners for event: "+t+", "+i,n.iawS),n.iawS[i])for(var a=n.iawS[i],o=e.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(r,t.name,o,t.additional_info)}}else n.kFVq.push({event:t,key:i,type:r})}))})),he=window.ApxorLogger,_e=function(){function t(){var n=this;return r(this,t),s(this,"wGOr",!1),s(this,"swPn",null),s(this,"BDCg",b()),s(this,"sUFj",new fe),s(this,"VMGo",e.getSiteId()),s(this,"IIUd",{}),s(this,"getQeState",(function(){try{var t=e.getController().getFromStorage("qe_state");return t?JSON.parse(w(n.VMGo,t)):(n.IIUd={},n.setQeState())}catch(e){return n.IIUd={},n.setQeState()}})),s(this,"setQeState",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{e.getController().persistToStorage("qe_state",n.IIUd,!0)}catch(i){""===t?n.IIUd={}:n.IIUd[t]={SESSION:0,OVERALL:0,DATES:{}},e.getController().persistToStorage("qe_state",n.IIUd,!0)}return n.IIUd})),s(this,"initialize",(function(){n.wGOr||(n.wGOr=!0,n.swPn=new ve,n.sUFj.initialize(),n.IIUd=n.getQeState(),he.info("QE Initialized.."))})),s(this,"parse",(function(e){n.BnuX()?(n.swPn.parse(e),n.sUFj.Lyjr()):he.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n.BnuX()&&n.swPn.validate(e,t,i)})),s(this,"getVariantCode",(function(e){return n.swPn.getVariantCode(e)})),s(this,"validateForTermination",(function(e,t){n.BnuX()&&n.swPn.validateForTermination(e,t)})),s(this,"validateForTerminationAttributes",(function(e,t){return n.swPn.validateForTerminationAttributes(e,t)})),s(this,"updateCount",(function(e){try{m(n.IIUd[e])||n.createObjConfig(e),n.incrementFrequencies(e),n.setQeState(e),n.swPn.SyFx(e)}catch(e){console.log("Could not update the count config:".concat(e))}})),s(this,"resetFrequencyCounts",(function(){n.swPn.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(e){return n.swPn.getFrequencyCount(e)})),s(this,"registerForEvent",(function(e,t){n.sUFj.pnCQ(e,t)})),s(this,"unregisterFromEvent",(function(e,t){n.sUFj.unregisterFromEvent(e,t)})),s(this,"notifyEventListener",(function(e){n.sUFj.tLdE(e)})),s(this,"fetch",(function(t,n,i,r){e.getController().fetchConfiguration(t,n,i,r)})),s(this,"BnuX",(function(){return n.wGOr})),s(this,"getCampaignMetaFromQueryEngine",(function(e){return n.swPn.Tavd(e)})),s(this,"tVby",(function(){return n.BDCg})),t.instance||(t.instance=this),t.instance}return o(t,[{key:"createObjConfig",value:function(e){try{this.IIUd=this.getQeState(),m(this.IIUd[e])||(this.IIUd[e]={SESSION:0,OVERALL:0,DATES:{}},this.BDCg&&(this.IIUd[e].DATES[this.BDCg]=0),this.setQeState(e))}catch(e){he.error("Can not create the frequency count object:"+e)}}},{key:"incrementFrequencies",value:function(e){this.IIUd=this.getQeState();var t=this.IIUd[e];t.SESSION=t.SESSION+1,t.OVERALL=t.OVERALL+1;var n=b();n===this.BDCg&&t.DATES&&t.DATES[n]||(this.BDCg=n,t.DATES={},t.DATES[this.BDCg]=0),t.DATES[this.BDCg]=t.DATES[this.BDCg]+1}}],[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}}]),t}();s(_e,"instance",void 0),window.ceVersion=201;try{void 0===exports&&null===exports||(exports.default=_e,module.exports=exports.default)}catch(e){}return _e}));
